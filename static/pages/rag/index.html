<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG - RAG Service</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="/static/pages/rag/style.css">
</head>
<body>
    <div id="app">
        <div class="rag-container">
            <!-- Êñá‰ª∂ÁÆ°ÁêÜÈù¢Êùø -->
            <div class="file-panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìÅ Êñá‰ª∂ÁÆ°ÁêÜ</h2>
                </div>
                
                <!-- ‰∏ä‰º†Âå∫Âüü -->
                <div class="upload-section">
                    <el-upload
                        class="upload-area"
                        action="/upload"
                        :on-success="handleUploadSuccess"
                        :on-error="handleUploadError"
                        :before-upload="beforeUpload"
                        :show-file-list="false"
                        drag>
                        <div class="upload-content">
                            <div class="upload-icon">üì§</div>
                            <div class="upload-text">ÁÇπÂáªÊàñÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§Ñ‰∏ä‰º†</div>
                            <div class="upload-hint">ÊîØÊåÅ txt, md, csv, pdf, doc, docx, xls, xlsx</div>
                        </div>
                    </el-upload>
                </div>
                
                <!-- ÊêúÁ¥¢Ê°Ü -->
                <div class="search-box">
                    <el-input
                        placeholder="ÊêúÁ¥¢Êñá‰ª∂Âêç..."
                        v-model="fileSearch"
                        prefix-icon="el-icon-search"
                        size="small"
                        clearable>
                    </el-input>
                </div>
                
                <!-- Êñá‰ª∂ÂàóË°® -->
                <div class="file-list-container">
                    <div class="file-list-header">
                        <el-checkbox v-model="selectAll" @change="handleSelectAll">
                            ÂÖ®ÈÄâ ({{ selectedFiles.length }}/{{ filteredFiles.length }})
                        </el-checkbox>
                    </div>
                    
                    <div class="file-list">
                        <div
                            v-for="(file, index) in filteredFiles"
                            :key="file.name"
                            class="file-item"
                            :class="{ 'is-selected': selectedFiles.includes(file.name) }"
                            @click="toggleFileSelection(file.name)">
                            <el-checkbox
                                :value="selectedFiles.includes(file.name)"
                                @change="toggleFileSelection(file.name)"
                                @click.stop>
                            </el-checkbox>
                            <div class="file-icon">{{ getFileIcon(file.type) }}</div>
                            <div class="file-info">
                                <div class="file-name" :title="file.name">{{ file.name }}</div>
                                <div class="file-meta">
                                    <span class="file-size">{{ formatFileSize(file.size) }}</span>
                                    <el-tag v-if="file.indexed" type="warning" size="mini" class="indexed-tag">Â∑≤Á¥¢Âºï</el-tag>
                                </div>
                            </div>
                        </div>
                        
                        <el-empty v-if="filteredFiles.length === 0" description="ÊöÇÊó†Êñá‰ª∂" :image-size="80"></el-empty>
                    </div>
                </div>
                
                <!-- Êìç‰ΩúÊåâÈíÆ -->
                <div class="file-actions">
                    <el-button type="primary" size="small" @click="handleIndexClick" :disabled="selectedFiles.length === 0">
                        ÂàõÂª∫Á¥¢Âºï
                    </el-button>
                    <el-button type="warning" size="small" @click="handleDeleteIndexClick" :disabled="selectedFiles.length === 0">
                        Âà†Èô§Á¥¢Âºï
                    </el-button>
                    <el-button type="danger" size="small" @click="handleDeleteClick" :disabled="selectedFiles.length === 0">
                        Âà†Èô§Êñá‰ª∂
                    </el-button>
                </div>
            </div>
            
            <!-- ÂØπËØùÈù¢Êùø -->
            <div class="chat-panel">
                <div class="chat-box">
                    <div class="chat-messages" ref="chatMessages">
                        <div v-for="(msg, index) in messages" :key="index" class="message" :class="msg.type">
                            <div class="message-avatar">
                                <span v-if="msg.type === 'user'">üë§</span>
                                <span v-else class="bot-avatar">ü§ñ</span>
                            </div>
                            <div class="message-content">
                                <div class="message-name">{{ msg.type === 'bot' ? 'AIÂ∞èÂä©Êâã' : 'Êàë' }}</div>
                                <div class="message-bubble">{{ msg.content }}</div>
                            </div>
                        </div>
                        <div v-if="loading" class="loading-indicator">
                            <div class="loading-dots">
                                <span></span><span></span><span></span>
                            </div>
                            <span>AI Ê≠£Âú®ÊÄùËÄÉ...</span>
                        </div>
                    </div>
                    
                    <div class="chat-input-area">
                        <div class="input-options">
                            <el-checkbox v-model="polishEnabled">‚ú® Ê∂¶Ëâ≤ÂõûÁ≠î</el-checkbox>
                        </div>
                        <div class="input-wrapper">
                            <el-input
                                type="textarea"
                                :rows="2"
                                placeholder="ËæìÂÖ•‰Ω†ÁöÑÈóÆÈ¢ò..."
                                v-model="inputMessage"
                                @keydown.enter.exact.prevent="sendMessage"
                                resize="none">
                            </el-input>
                            <el-button type="primary" @click="sendMessage" :loading="loading" class="send-btn">
                                ÂèëÈÄÅ
                            </el-button>
                        </div>
                    </div>
                </div>
                
                <!-- Âè≥‰æß RAG ÊñπÊ≥ïÈù¢Êùø -->
                <div class="rag-sidebar">
                    <div class="rag-sidebar-header">
                        <h3>üß† RAG ÊñπÊ≥ï (17Áßç)</h3>
                    </div>
                    
                    <div class="rag-methods-list">
                        <!-- ÂéüÂßãÊñáÊ°£Â¢ûÂº∫ -->
                        <div class="method-group">
                            <div class="group-title">üìÑ ÂéüÂßãÊñáÊ°£Â¢ûÂº∫</div>
                            <div
                                v-for="method in docMethods"
                                :key="method.id"
                                class="method-item"
                                :class="{ active: selectedMethod === method.id }">
                                <div class="method-header" @click="toggleMethod(method.id)">
                                    <span class="method-number">{{ method.num }}</span>
                                    <div class="method-info">
                                        <div class="method-name">{{ method.name }}</div>
                                        <div class="method-desc">{{ method.desc }}</div>
                                    </div>
                                    <span class="method-arrow">{{ expandedMethod === method.id ? '‚ñº' : '‚ñ∂' }}</span>
                                </div>
                                <div class="method-detail" v-if="expandedMethod === method.id">
                                    <div class="detail-row">
                                        <span class="detail-label">üí° ÈÄÇÂêàÂú∫ÊôØÔºö</span>
                                        <span class="detail-value">{{ method.scenarios }}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">üìö ÈÄÇÂêàÊñáÊ°£Ôºö</span>
                                        <span class="detail-value">{{ method.documents }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Êü•ËØ¢ÊñáÊ°£Â¢ûÂº∫ -->
                        <div class="method-group">
                            <div class="group-title">üîç Êü•ËØ¢ÊñáÊ°£Â¢ûÂº∫</div>
                            <div
                                v-for="method in queryMethods"
                                :key="method.id"
                                class="method-item"
                                :class="{ active: selectedMethod === method.id }">
                                <div class="method-header" @click="toggleMethod(method.id)">
                                    <span class="method-number">{{ method.num }}</span>
                                    <div class="method-info">
                                        <div class="method-name">{{ method.name }}</div>
                                        <div class="method-desc">{{ method.desc }}</div>
                                    </div>
                                    <span class="method-arrow">{{ expandedMethod === method.id ? '‚ñº' : '‚ñ∂' }}</span>
                                </div>
                                <div class="method-detail" v-if="expandedMethod === method.id">
                                    <div class="detail-row">
                                        <span class="detail-label">üí° ÈÄÇÂêàÂú∫ÊôØÔºö</span>
                                        <span class="detail-value">{{ method.scenarios }}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">üìö ÈÄÇÂêàÊñáÊ°£Ôºö</span>
                                        <span class="detail-value">{{ method.documents }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@2.7.14/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="/static/pages/rag/app.js"></script>
</body>
</html>