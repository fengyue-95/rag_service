<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êñá‰ª∂ÁÆ°ÁêÜ - RAG Service</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="/static/pages/files/style.css">
</head>
<body>
    <div id="app">
        <div class="files-container">
            <div class="page-header">
                <h1>üìÅ Êñá‰ª∂ÁÆ°ÁêÜ</h1>
                <div class="header-actions">
                    <el-button type="primary" icon="el-icon-refresh" @click="loadFiles">Âà∑Êñ∞</el-button>
                    <el-button type="success" icon="el-icon-upload2" @click="showUploadDialog">‰∏ä‰º†Êñá‰ª∂</el-button>
                </div>
            </div>

            <div class="search-bar">
                <el-input
                    placeholder="ÊêúÁ¥¢Êñá‰ª∂Âêç..."
                    v-model="searchKeyword"
                    prefix-icon="el-icon-search"
                    clearable
                    class="search-input">
                </el-input>
                <el-select v-model="statusFilter" placeholder="Áä∂ÊÄÅÁ≠õÈÄâ" clearable class="status-filter">
                    <el-option label="ÂÖ®ÈÉ®" value=""></el-option>
                    <el-option label="Â∑≤‰∏ä‰º†" value="uploaded"></el-option>
                    <el-option label="Â∑≤Á¥¢Âºï" value="indexed"></el-option>
                </el-select>
            </div>

            <div class="files-content">
                <el-table
                    :data="filteredFiles"
                    style="width: 100%"
                    row-class-name="file-table-row"
                    @selection-change="handleSelectionChange">
                    <el-table-column type="selection" width="50"></el-table-column>
                    <el-table-column label="Êñá‰ª∂Âêç" min-width="200">
                        <template slot-scope="{ row }">
                            <div class="file-name-cell">
                                <span class="file-icon">{{ getFileIcon(row.type) }}</span>
                                <span class="file-name">{{ row.name }}</span>
                            </div>
                        </template>
                    </el-table-column>
                    <el-table-column prop="size" label="Â§ßÂ∞è" width="100" :formatter="formatSize"></el-table-column>
                    <el-table-column label="Áä∂ÊÄÅ" width="120">
                        <template slot-scope="{ row }">
                            <el-tag :type="row.indexed ? 'warning' : 'info'" size="small">
                                {{ row.indexed ? 'Â∑≤Á¥¢Âºï' : 'Â∑≤‰∏ä‰º†' }}
                            </el-tag>
                        </template>
                    </el-table-column>
                    <el-table-column prop="uploadTime" label="‰∏ä‰º†Êó∂Èó¥" width="160"></el-table-column>
                    <el-table-column label="Êìç‰Ωú" width="180" fixed="right">
                        <template slot-scope="{ row }">
                            <el-button type="text" size="small" @click="viewFile(row)">Êü•Áúã</el-button>
                            <el-button type="text" size="small" @click="deleteFile(row)" class="danger-btn">Âà†Èô§</el-button>
                        </template>
                    </el-table-column>
                </el-table>

                <el-empty v-if="filteredFiles.length === 0" description="ÊöÇÊó†Êñá‰ª∂" :image-size="100"></el-empty>
            </div>

            <div class="table-footer" v-if="filteredFiles.length > 0">
                <div class="selection-info">
                    Â∑≤ÈÄâÊã© <span class="highlight">{{ selectedFiles.length }}</span> È°π
                </div>
                <div class="footer-actions">
                    <el-button size="small" @click="handleSelectionChange([])">Ê∏ÖÁ©∫ÈÄâÊã©</el-button>
                    <el-button type="warning" size="small" @click="batchIndex" :disabled="selectedFiles.length === 0">
                        ÊâπÈáèÁ¥¢Âºï
                    </el-button>
                    <el-button type="danger" size="small" @click="batchDelete" :disabled="selectedFiles.length === 0">
                        ÊâπÈáèÂà†Èô§
                    </el-button>
                </div>
            </div>

            <!-- ‰∏ä‰º†ÂØπËØùÊ°Ü -->
            <el-dialog title="‰∏ä‰º†Êñá‰ª∂" :visible.sync="uploadDialogVisible" width="500px">
                <el-upload
                    class="upload-dialog"
                    action="/upload"
                    :on-success="handleUploadSuccess"
                    :on-error="handleUploadError"
                    :before-upload="beforeUpload"
                    :show-file-list="false"
                    drag
                    multiple>
                    <i class="el-icon-upload"></i>
                    <div class="el-upload__text">Â∞ÜÊñá‰ª∂ÊãñÊãΩÂà∞Ê≠§Â§ÑÔºåÊàñ <em>ÁÇπÂáª‰∏ä‰º†</em></div>
                    <div class="el-upload__tip">ÊîØÊåÅ txt, md, csv, pdf, doc, docx, xls, xlsx</div>
                </el-upload>
            </el-dialog>

            <!-- Êñá‰ª∂ËØ¶ÊÉÖÂØπËØùÊ°Ü -->
            <el-dialog title="Êñá‰ª∂ËØ¶ÊÉÖ" :visible.sync="detailDialogVisible" width="600px">
                <div class="file-detail" v-if="currentFile">
                    <div class="detail-row">
                        <span class="detail-label">Êñá‰ª∂ÂêçÔºö</span>
                        <span class="detail-value">{{ currentFile.name }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Â§ßÂ∞èÔºö</span>
                        <span class="detail-value">{{ formatSize(null, null, currentFile.size) }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Á±ªÂûãÔºö</span>
                        <span class="detail-value">{{ currentFile.type }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Áä∂ÊÄÅÔºö</span>
                        <el-tag :type="currentFile.indexed ? 'warning' : 'info'" size="small">
                            {{ currentFile.indexed ? 'Â∑≤Á¥¢Âºï' : 'Â∑≤‰∏ä‰º†' }}
                        </el-tag>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">‰∏ä‰º†Êó∂Èó¥Ôºö</span>
                        <span class="detail-value">{{ currentFile.uploadTime }}</span>
                    </div>
                </div>
            </el-dialog>
        </div>
    </div>

    <script src="https://unpkg.com/vue@2.7.14/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="/static/pages/files/app.js"></script>
</body>
</html>