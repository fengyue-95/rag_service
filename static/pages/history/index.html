<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂéÜÂè≤ËÆ∞ÂΩï - RAG Service</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="/static/pages/history/style.css">
</head>
<body>
    <div id="app">
        <div class="history-container">
            <div class="page-header">
                <h1>üìú ÂéÜÂè≤ËÆ∞ÂΩï</h1>
                <div class="header-actions">
                    <el-radio-group v-model="viewMode" size="small">
                        <el-radio-button label="grouped">ÊåâÊó•Êúü</el-radio-button>
                        <el-radio-button label="list">ÂàóË°®</el-radio-button>
                    </el-radio-group>
                    <el-button type="danger" size="small" icon="el-icon-delete" @click="clearAllHistory" :disabled="!hasHistory">
                        Ê∏ÖÁ©∫ÂéÜÂè≤
                    </el-button>
                </div>
            </div>

            <div class="search-bar">
                <el-input
                    placeholder="ÊêúÁ¥¢ÂéÜÂè≤ËÆ∞ÂΩï..."
                    v-model="searchKeyword"
                    prefix-icon="el-icon-search"
                    clearable
                    class="search-input">
                </el-input>
            </div>

            <!-- ÂàÜÁªÑËßÜÂõæ -->
            <div class="history-content grouped-view" v-if="viewMode === 'grouped'">
                <div v-for="(chats, date) in groupedChats" :key="date" class="date-group">
                    <div class="date-header">
                        <span class="date-icon">üìÖ</span>
                        <span class="date-text">{{ date }}</span>
                        <span class="date-count">{{ chats.length }} Êù°ÂØπËØù</span>
                    </div>
                    <div class="chat-cards">
                        <div
                            v-for="chat in chats"
                            :key="chat.id"
                            class="chat-card"
                            @click="openChatDetail(chat)">
                            <div class="chat-card-header">
                                <span class="chat-icon">üí¨</span>
                                <span class="chat-title">{{ chat.title }}</span>
                            </div>
                            <div class="chat-card-preview">{{ getChatPreview(chat) }}</div>
                            <div class="chat-card-footer">
                                <span class="chat-time">{{ chat.time }}</span>
                                <el-button type="text" size="mini" icon="el-icon-delete" class="delete-btn" @click.stop="deleteChat(chat.id)"></el-button>
                            </div>
                        </div>
                    </div>
                </div>
                <el-empty v-if="Object.keys(groupedChats).length === 0" description="ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï" :image-size="100"></el-empty>
            </div>

            <!-- ÂàóË°®ËßÜÂõæ -->
            <div class="history-content list-view" v-if="viewMode === 'list'">
                <el-table :data="filteredChats" style="width: 100%" row-class-name="history-row" @row-click="openChatDetail">
                    <el-table-column label="Ê†áÈ¢ò" min-width="200">
                        <template slot-scope="{ row }">
                            <div class="table-title-cell">
                                <span class="title-icon">üí¨</span>
                                <span class="title-text">{{ row.title }}</span>
                            </div>
                        </template>
                    </el-table-column>
                    <el-table-column label="ÂØπËØùÂÜÖÂÆπ" min-width="250">
                        <template slot-scope="{ row }">
                            <span class="preview-text">{{ getChatPreview(row) }}</span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="time" label="Êó∂Èó¥" width="160"></el-table-column>
                    <el-table-column label="Êìç‰Ωú" width="100">
                        <template slot-scope="{ row }">
                            <el-button type="text" size="small" icon="el-icon-delete" @click.stop="deleteChat(row.id)" class="delete-btn"></el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </div>

            <!-- ÂØπËØùËØ¶ÊÉÖÊäΩÂ±â -->
            <el-drawer title="ÂØπËØùËØ¶ÊÉÖ" :visible.sync="drawerVisible" direction="rtl" size="50%">
                <div class="chat-detail" v-if="currentChat">
                    <div class="detail-header">
                        <h3>{{ currentChat.title }}</h3>
                        <span class="detail-time">{{ currentChat.time }}</span>
                    </div>
                    <div class="detail-messages">
                        <div v-for="(msg, i) in currentChat.messages" :key="i" class="detail-message" :class="msg.role">
                            <div class="detail-avatar">{{ msg.role === 'user' ? 'üë§' : 'ü§ñ' }}</div>
                            <div class="detail-content">
                                <div class="detail-role">{{ msg.role === 'user' ? 'Êàë' : 'AIÂä©Êâã' }}</div>
                                <div class="detail-text">{{ msg.content }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="detail-actions">
                        <el-button type="primary" size="small" @click="continueChat">ÁªßÁª≠ÂØπËØù</el-button>
                        <el-button type="danger" size="small" @click="deleteChat(currentChat.id)">Âà†Èô§</el-button>
                    </div>
                </div>
            </el-drawer>
        </div>
    </div>

    <script src="https://unpkg.com/vue@2.7.14/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="/static/pages/history/app.js"></script>
</body>
</html>