<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êô∫ËÉΩÂØπËØù - RAG Service</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="/static/pages/chat/style.css">
</head>
<body>
    <div id="app">
        <div class="chat-container">
            <!-- ÂØπËØùÂàóË°®‰æßËæπÊ†è -->
            <div class="chat-sidebar">
                <div class="sidebar-header">
                    <h2>üí¨ Êô∫ËÉΩÂØπËØù</h2>
                    <el-button type="primary" icon="el-icon-plus" circle @click="newChat"></el-button>
                </div>
                
                <div class="chat-search">
                    <el-input placeholder="ÊêúÁ¥¢ÂØπËØù..." v-model="searchKeyword" prefix-icon="el-icon-search" size="small" clearable>
                    </el-input>
                </div>
                
                <div class="chat-list">
                    <div
                        v-for="chat in filteredChats"
                        :key="chat.id"
                        class="chat-item"
                        :class="{ active: currentChatId === chat.id }"
                        @click="selectChat(chat.id)">
                        <div class="chat-item-icon">{{ chat.icon }}</div>
                        <div class="chat-item-info">
                            <div class="chat-item-title">{{ chat.title }}</div>
                            <div class="chat-item-time">{{ chat.time }}</div>
                        </div>
                        <el-dropdown trigger="click" @command="handleChatCommand($event, chat.id)">
                            <span class="chat-item-more">‚ãØ</span>
                            <el-dropdown-menu slot="dropdown">
                                <el-dropdown-item command="rename">ÈáçÂëΩÂêç</el-dropdown-item>
                                <el-dropdown-item command="delete" divided>Âà†Èô§</el-dropdown-item>
                            </el-dropdown-menu>
                        </el-dropdown>
                    </div>
                    
                    <el-empty v-if="filteredChats.length === 0" description="ÊöÇÊó†ÂØπËØù" :image-size="60"></el-empty>
                </div>
            </div>
            
            <!-- ÂØπËØù‰∏ªÂå∫Âüü -->
            <div class="chat-main">
                <div class="chat-messages" ref="chatMessages">
                    <div v-for="(msg, index) in currentMessages" :key="index" class="message" :class="msg.role">
                        <div class="message-avatar">
                            <span v-if="msg.role === 'user'">üë§</span>
                            <span v-else class="bot-avatar">ü§ñ</span>
                        </div>
                        <div class="message-content">
                            <div class="message-role">{{ msg.role === 'user' ? 'Êàë' : 'AIÂä©Êâã' }}</div>
                            <div class="message-text" v-html="formatMessage(msg.content)"></div>
                        </div>
                    </div>
                    
                    <div v-if="loading" class="loading-indicator">
                        <div class="loading-spinner"></div>
                        <span>AI Ê≠£Âú®ÊÄùËÄÉ...</span>
                    </div>
                </div>
                
                <!-- ËæìÂÖ•Âå∫Âüü -->
                <div class="chat-input-area">
                    <div class="input-options">
                        <el-checkbox v-model="polishEnabled">‚ú® Ê∂¶Ëâ≤ÂõûÁ≠î</el-checkbox>
                        <el-select v-model="selectedModel" size="small" class="model-select">
                            <el-option label="DeepSeek" value="deepseek"></el-option>
                            <el-option label="Ollama" value="ollama"></el-option>
                        </el-select>
                    </div>
                    <div class="input-wrapper">
                        <el-input
                            type="textarea"
                            :rows="2"
                            placeholder="ËæìÂÖ•ÈóÆÈ¢òÔºåÊåâ Enter ÂèëÈÄÅ..."
                            v-model="inputMessage"
                            @keydown.enter.exact.prevent="sendMessage"
                            resize="none">
                        </el-input>
                        <el-button type="primary" @click="sendMessage" :loading="loading" class="send-btn">
                            ÂèëÈÄÅ
                        </el-button>
                    </div>
                    
                    <!-- Âª∫ËÆÆÈóÆÈ¢ò -->
                    <div class="suggestions" v-if="suggestions.length > 0 && !inputMessage">
                        <div class="suggestions-title">üí° Âª∫ËÆÆÈóÆÈ¢ò</div>
                        <div class="suggestions-list">
                            <el-tag
                                v-for="(q, i) in suggestions"
                                :key="i"
                                class="suggestion-tag"
                                @click="askSuggestion(q)">
                                {{ q }}
                            </el-tag>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@2.7.14/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="/static/pages/chat/app.js"></script>
</body>
</html>